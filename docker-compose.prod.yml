services:
  web:
    build:
      context: .
      dockerfile: Dockerfile.prod
    container_name: reformly-web
    environment:
      - NODE_ENV=production
      - HOSTNAME=0.0.0.0
      - PORT=3000
    restart: unless-stopped
    labels:
      # Traefik labels for automatic service discovery
      - "traefik.enable=true"
      - "traefik.http.routers.reformly-web.rule=Host(`web.129.212.162.195.sslip.io`)"
      - "traefik.http.routers.reformly-web.entrypoints=websecure"
      - "traefik.http.routers.reformly-web.tls.certresolver=letsencrypt"
      - "traefik.http.services.reformly-web.loadbalancer.server.port=3000"
      # Alternative HTTP entrypoint (uncomment if needed)
      # - "traefik.http.routers.reformly-web-http.rule=Host(`web.129.212.162.195.sslip.io`)"
      # - "traefik.http.routers.reformly-web-http.entrypoints=web"
      # - "traefik.http.routers.reformly-web-http.middlewares=redirect-to-https"
    networks:
      - default
      - traefik_network
    # No ports exposed - using reverse proxy with domain on server
    # No volumes - using built image
    # For local testing, use docker-compose.prod.local.yml

networks:
  default:
    name: reformly_web_default
  traefik_network:
    external: true
    name: docker_default

